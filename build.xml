<?xml version="1.0"?>
<project default="test" name="lcov">
  <condition property="composer" value="C:\Program Files\PHP\share\composer.phar" else="/usr/local/bin/composer">
    <os family="windows"/>
  </condition>

  <target name="clean" description="Delete all generated files and reset any saved state">
    <delete dir="build" quiet="true"/>
    <delete dir="doc/api" quiet="true"/>
    <delete dir="web" quiet="true"/>
    <delete includeEmptyDirs="true">
      <fileSet dir="var" includes="**/*" excludes=".gitkeep"/>
    </delete>
  </target>

  <target name="coverage" description="Send the results of the code coverage">
    <exec command="coveralls var/coverage.xml" passthru="true"/>
  </target>

  <target name="doc" description="Build the documentation">
    <exec executable="vendor/bin/phpdoc" passthru="true"/>
    <exec command="mkdocs build" passthru="true"/>
  </target>

  <target name="lint" description="Perform the static analysis of source code">
    <phpLint file="example/main.php"/>
    <exec executable="vendor/bin/phpstan" passthru="true">
      <arg value="analyse"/>
    </exec>
  </target>

  <target name="test" description="Run the test suites">
    <exec executable="vendor/bin/phpunit" passthru="true"/>
  </target>

  <target name="upgrade" description="Upgrade the project to the latest revision">
    <exec command="git reset --hard" passthru="true"/>
    <exec command="git fetch --all --prune" passthru="true"/>
    <exec command="git pull --rebase" passthru="true"/>
    <composer command="update" composer="${composer}"/>
  </target>
</project>
